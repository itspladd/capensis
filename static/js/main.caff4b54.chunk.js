(this.webpackJsonpcapensis=this.webpackJsonpcapensis||[]).push([[0],{44:function(e,t,n){},45:function(e,t,n){},74:function(e,t,n){},76:function(e,t,n){},77:function(e,t,n){},78:function(e,t,n){"use strict";n.r(t);n(39);var c=n(1),a=n.n(c),s=n(16),r=n.n(s),i=(n(44),n(3)),l=(n(45),n(4)),o=n.n(l),j=n(18),u=n(5),b=n(0);function d(e){var t=e.username,n=e.handleLogout;e.currentSession;return Object(b.jsx)("div",{className:"navbar navbar-expand-sm navbar-light bg-info",children:Object(b.jsxs)("div",{className:"container-fluid",children:[Object(b.jsx)(j.b,{className:"navbar-brand",to:"/",children:"Capensis"}),Object(b.jsx)("button",{className:"navbar-toggler",type:"button","data-bs-toggle":"collapse","data-bs-target":"#navbarSupportedContent","aria-controls":"navbarSupportedContent","aria-expanded":"false","aria-label":"Toggle navigation",children:Object(b.jsx)("span",{className:"navbar-toggler-icon"})}),Object(b.jsx)("div",{className:"collapse navbar-collapse",id:"navbarSupportedContent",children:Object(b.jsxs)("ul",{className:"navbar-nav me-auto mb-2 mb-lg-0",children:[Object(b.jsx)("li",{className:"nav-item",children:Object(b.jsx)(j.c,{className:"nav-link",to:"/schedule",children:"Schedule"})}),Object(b.jsx)("li",{className:"nav-item",children:Object(b.jsx)(j.c,{to:"/projects",className:"nav-link",children:"Projects"})}),Object(b.jsx)("li",{className:"nav-item",children:Object(b.jsx)(j.c,{className:"nav-link",to:"/reports",children:"Reports"})})]})}),Object(b.jsxs)("div",{className:"d-flex",children:[Object(b.jsxs)("span",{className:"navbar-text me-2",children:["Logged in as ",t]}),Object(b.jsx)("button",{className:"btn btn-outline-dark",onClick:n,children:"Logout"})]})]})})}n(74);function m(e){var t=e.currentSession,n=e.projects,c=void 0!==t.id,a=c&&n[t.project_id].title;return Object(b.jsxs)("div",{className:"statusBar mb-2 border-top border-info\n      ".concat(c?"bg-warning":"bg-info"),children:[t.id&&"Currently tracking ".concat(a),!t.id&&"Not currently tracking"]})}var h=n(27),O=n.n(h),p=n(38),x=n(21),f=n(19),v=n(2);function g(e){var t=Object(c.useState)(e),n=Object(i.a)(t,2),a=n[0],s=n[1];return[a,function(e){e.preventDefault(),s((function(t){var n=Object(v.a)({},t);return n[e.target.name]=e.target.value,console.log(n),n}))}]}function N(e){var t=e.show,n=(e.handleShow,e.handleClose),a=e.currentDay,s=e.projects,r=e.blocks,l=e.refreshBlocks,j=Object(c.useState)(!1),u=Object(i.a)(j,2),d=u[0],m=u[1],h=Object(c.useState)(!1),v=Object(i.a)(h,2),N=v[0],w=v[1],k=Object(c.useState)({valid:!0,msg:""}),S=Object(i.a)(k,2),C=S[0],y=S[1],M=g({project:"",startHour:"6",startMinute:"00",startAMPM:"0",endHour:"6",endMinute:"00",endAMPM:"0"}),P=Object(i.a)(M,2),D=P[0],_=P[1],H=a.toDateString(),A=function(e,t){return 60*e+t},U=Object(c.useCallback)((function(e){var t=Number(e.startHour)+Number(e.startAMPM),n=Number(e.startMinute),c=Number(e.endHour)+Number(e.endAMPM),a=Number(e.endMinute);return[A(t,n),A(c,a)]}),[]),F=function(){var e=Object(p.a)(O.a.mark((function e(t){var c,s,r,j,u,b,m,h,p,x;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.preventDefault(),c=U(D),s=Object(i.a)(c,2),r=s[0],j=s[1],r>j?(u=!1,b="Submit failed - that block starts before its end time!"):d||N?(u=!1,b="Submit failed - your start or end time conflicts with an existing block."):""===D.project?(u=!1,b="Submit failed - select a project first!"):(u=!0,b="Validation successful, submitting!",m=a.valueOf()+60*r*1e3,h=a.valueOf()+60*j*1e3,p=new Date(m).toISOString(),x=new Date(h).toISOString(),o.a.post("/api/blocks",{startTime:p,endTime:x,project:D.project}).then((function(e){console.log(e),l()})),n()),y({valid:u,msg:b});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();Object(c.useEffect)((function(){m(!1),w(!1);var e=U(D),t=Object(i.a)(e,2),n=t[0],c=t[1];r.filter((function(e){return new Date(e.start_time).getDate()===a.getDate()})).forEach((function(e){var t=new Date(e.start_time),a=new Date(e.end_time),s=A(t.getHours(),t.getMinutes()),r=A(a.getHours(),a.getMinutes());n>=s&&n<r&&m(!0),c>s&&c<=r&&w(!0)}))}),[D,a,r,U]);var E=Object.values(s).reverse().map((function(e){return Object(b.jsx)("option",{value:e.id,children:e.title})})),B=function(){for(var e=[],t=1;t<=12;t++)e.push(Object(b.jsx)("option",{children:t}));return e}();return Object(b.jsx)(b.Fragment,{children:Object(b.jsxs)(f.a,{show:t,onHide:n,children:[Object(b.jsx)(f.a.Header,{closeButton:!0,children:Object(b.jsx)(f.a.Title,{children:"Schedule a new Block "})}),Object(b.jsxs)(f.a.Body,{children:["Date: ",Object(b.jsx)("strong",{children:H}),Object(b.jsxs)("form",{onSubmit:F,children:[Object(b.jsxs)("div",{className:"row row-cols-lg-auto g-5 align-items-center",children:[Object(b.jsx)("label",{for:"project",children:"Project"}),Object(b.jsx)("div",{class:"col-12",children:Object(b.jsxs)("select",{class:"form-select",name:"project",id:"project",value:D.project,onChange:_,children:[Object(b.jsx)("option",{value:"",children:"Select a project"}),E]})})]}),Object(b.jsxs)("div",{className:"row row-cols-lg-auto g-2 mt-1 align-items-center",children:[Object(b.jsx)("label",{for:"startHour",children:"Starting at:"}),Object(b.jsx)("div",{className:"col-12",children:Object(b.jsx)("select",{className:"form-select",name:"startHour",id:"startHour",value:D.startHour,onChange:_,children:B})}),Object(b.jsx)("div",{className:"col-12",children:Object(b.jsxs)("select",{class:"form-select",name:"startMinute",id:"startMinute",value:D.startMinute,onChange:_,children:[Object(b.jsx)("option",{children:"00"}),Object(b.jsx)("option",{children:"15"}),Object(b.jsx)("option",{children:"30"}),Object(b.jsx)("option",{children:"45"})]})}),Object(b.jsx)("div",{className:"col-12",children:Object(b.jsxs)("select",{class:"form-select",name:"startAMPM",id:"startAMPM",value:D.startAMPM,onChange:_,children:[Object(b.jsx)("option",{value:"0",children:"AM"}),Object(b.jsx)("option",{value:"12",children:"PM"})]})}),d&&Object(b.jsx)("small",{id:"passwordHelpBlock",class:"form-text text-muted",children:"That start time conflicts with an existing Block!"})]}),Object(b.jsxs)("div",{className:"row row-cols-lg-auto g-2 mt-1 align-items-center",children:[Object(b.jsx)("label",{children:"Ending at:"}),Object(b.jsx)("div",{className:"col-12",children:Object(b.jsx)("select",{class:"form-select",name:"endHour",id:"endHour",value:D.endHour,onChange:_,children:B})}),Object(b.jsx)("div",{className:"col-12",children:Object(b.jsxs)("select",{class:"form-select",name:"endMinute",id:"endMinute",value:D.endMinute,onChange:_,children:[Object(b.jsx)("option",{children:"00"}),Object(b.jsx)("option",{children:"15"}),Object(b.jsx)("option",{children:"30"}),Object(b.jsx)("option",{children:"45"})]})}),Object(b.jsx)("div",{className:"col-12",children:Object(b.jsxs)("select",{class:"form-select",name:"endAMPM",id:"endAMPM",value:D.endAMPM,onChange:_,children:[Object(b.jsx)("option",{value:"0",children:"AM"}),Object(b.jsx)("option",{value:"12",children:"PM"})]})}),N&&Object(b.jsx)("small",{id:"passwordHelpBlock",class:"form-text text-muted",children:"That end time conflicts with an existing Block!"})]})]})]}),!C.valid&&Object(b.jsx)(f.a.Footer,{children:C.msg}),Object(b.jsxs)(f.a.Footer,{children:[Object(b.jsx)(x.a,{variant:"secondary",onClick:n,children:"Close"}),Object(b.jsx)(x.a,{variant:"primary",onClick:F,children:"Submit"})]})]})})}function w(e){var t=e.setUsername,n=g({loginUsername:"",loginPass:"",registerUsername:"",registerPass:""}),c=Object(i.a)(n,2),a=c[0],s=c[1];return Object(b.jsxs)("div",{className:"login-register",children:[Object(b.jsx)("div",{className:"login m-2",children:Object(b.jsxs)("form",{className:"row row-cols-sm-auto g-3 align-items-center",onSubmit:function(e){e.preventDefault();var n=a.loginUsername,c=a.loginPass;console.log("Logging in with username: ".concat(n," and password: ").concat(c)),o.a.post("/api/login",{username:n,rawPassword:c}).then((function(e){return t(e.data.username)}))},children:[Object(b.jsx)("div",{className:"col-12",children:Object(b.jsx)("label",{className:"form-label",htmlFor:"loginUsername",children:"Username: "})}),Object(b.jsx)("div",{className:"col-12",children:Object(b.jsx)("input",{className:"form-control",name:"loginUsername",type:"text",value:a.loginUsername,onChange:s})}),Object(b.jsx)("div",{className:"col-12",children:Object(b.jsx)("label",{className:"form-label",htmlFor:"loginPass",children:"Password: "})}),Object(b.jsx)("div",{className:"col-12",children:Object(b.jsx)("input",{className:"form-control",name:"loginPass",type:"password",value:a.loginPass,onChange:s})}),Object(b.jsx)("div",{className:"col-12",children:Object(b.jsx)("button",{class:"btn btn-success",children:"Login"})})]})}),Object(b.jsx)("div",{className:"register m-2",children:Object(b.jsxs)("form",{className:"row row-cols-sm-auto g-3 align-items-center",onSubmit:function(e){e.preventDefault();var n=a.registerUsername,c=a.registerPass;console.log("Registering a new user with username: ".concat(n," and password: ").concat(c)),o.a.post("/api/users",{username:n,rawPassword:c}).then((function(e){return t(e.data.username)}))},children:[Object(b.jsx)("div",{className:"col-12",children:Object(b.jsx)("label",{className:"form-label",htmlFor:"registerUsername",children:"Username: "})}),Object(b.jsx)("div",{className:"col-12",children:Object(b.jsx)("input",{className:"form-control",name:"registerUsername",type:"text",value:a.registerUsername,onChange:s})}),Object(b.jsx)("div",{className:"col-12",children:Object(b.jsx)("label",{className:"form-label",htmlFor:"registerPass",children:"Password: "})}),Object(b.jsx)("div",{className:"col-12",children:Object(b.jsx)("input",{className:"form-control",name:"registerPass",type:"password",value:a.registerPass,onChange:s})}),Object(b.jsx)("div",{className:"col-12",children:Object(b.jsx)("button",{className:"btn btn-success",children:"Register"})})]})})]})}n(76),n(77);function k(e){var t=e.title,n=e.project_id,c=(e.length,e.day,e.start_time),a=e.end_time,s=new Date(c).toLocaleTimeString(),r=new Date(a).toLocaleTimeString();return Object(b.jsxs)("li",{className:"block list-group-item",projectid:n,children:[Object(b.jsx)("h5",{children:t}),"From: ",s," to ",r]})}function S(e){var t=e.blocks,n=e.day,c=t.filter((function(e){return new Date(e.start_time).getDate()===n.getDate()})).map((function(e){return Object(b.jsx)(k,Object(v.a)(Object(v.a)({},e),{},{day:new Date(e.start_time),length:(t=e.start_time,n=e.end_time,(new Date(n)-new Date(t))/1e3/60/15)}));var t,n}));return Object(b.jsx)("ul",{className:"blockList list-group ms-2 me-2",children:c})}function C(e){var t=e.blocks,n=e.day,c=e.tomorrow,a=e.yesterday,s=e.showForm;return Object(b.jsxs)("div",{className:"daySchedule",children:[Object(b.jsx)("h3",{children:n.toDateString()}),Object(b.jsx)(x.a,{variant:"primary",onClick:s,children:"Make a new block"}),Object(b.jsxs)("div",{className:"dayScheduleInternal mt-2",children:[Object(b.jsx)("button",{className:"btn btn-primary",onClick:a,children:"<--"}),Object(b.jsx)(S,{blocks:t,day:n}),Object(b.jsx)("button",{className:"btn btn-primary",onClick:c,children:"--\x3e"})]})]})}function y(e){return Object(b.jsx)("div",{children:Object(b.jsx)("p",{children:"WeekSchedule component"})})}var M=n(12);function P(e){var t=e.id,n=e.title,c=e.selected,a=e.onEditClick,s=e.onCancelClick,r=e.onSubmit,i=e.formValue,l=e.handleChange;return Object(b.jsxs)("li",{className:"list-group-item d-flex justify-content-between bg-light",children:[Object(b.jsx)("span",{children:Object(b.jsx)("strong",{children:n})}),c&&Object(b.jsxs)("form",{className:"row row-cols-sm-auto g-3 align-items-center",onSubmit:r,children:[Object(b.jsxs)("div",{className:"col-12",children:[Object(b.jsx)("label",{className:"visually-hidden",htmlFor:"newName",children:"New name: "}),Object(b.jsx)("input",{type:"text",className:"form-control form-control-sm",id:"newName",value:i,onChange:l})]}),Object(b.jsx)("div",{className:"col-12",children:Object(b.jsx)("button",{className:"btn btn-sm btn-secondary",children:"Submit"})}),Object(b.jsx)("div",{className:"col-12",children:Object(b.jsx)("button",{className:"btn btn-sm btn-danger",onClick:s,children:"Cancel"})})]}),!c&&Object(b.jsx)("button",{className:"btn btn-sm btn-info",onClick:a,children:"Rename"})]},t)}function D(e){var t=e.projects,n=e.setProjects,a=Object(c.useState)(null),s=Object(i.a)(a,2),r=s[0],l=s[1],j=Object(c.useState)(null),u=Object(i.a)(j,2),d=u[0],m=u[1],h=Object(c.useState)(!1),O=Object(i.a)(h,2),p=O[0],x=O[1],f=Object(c.useState)(""),g=Object(i.a)(f,2),N=g[0],w=g[1],k=function(e){e.preventDefault(),l(null)},S=function(e){m(e.target.value)},C=Object.values(t).map((function(e){return Object(b.jsx)(P,Object(v.a)(Object(v.a)({},e),{},{selected:e.id===r,onEditClick:function(){return l(e.id)},onCancelClick:k,onSubmit:function(c){return function(e,c){e.preventDefault();var a=null!==d?d:t[c].title;l(null),m(null);var s=Object(v.a)(Object(v.a)({},t[c]),{},{title:a});n((function(e){return Object(v.a)(Object(v.a)({},e),{},Object(M.a)({},c,s))})),o.a.patch("/api/projects/".concat(c),{title:a}).then((function(e){return console.log(e)}))}(c,e.id)},handleChange:S,formValue:null===d?e.title:d}))}));return Object(b.jsxs)("div",{className:"container",children:[Object(b.jsx)("h3",{children:"My Projects"}),Object(b.jsx)("ul",{className:"list-group",children:C}),Object(b.jsxs)("div",{className:"newProject",children:[!p&&Object(b.jsx)("button",{className:"btn btn-primary",onClick:function(){return x(!0)},children:"Add a Project"}),p&&Object(b.jsxs)("form",{className:"row row-cols-lg-auto g-3",onSubmit:function(e){e.preventDefault(),o.a.post("/api/projects",{projectTitle:N}).then((function(e){var t=e.data;n((function(e){return Object(v.a)(Object(v.a)({},e),{},Object(M.a)({},t.id,t))}))})).then((function(){w(""),x(!1)}))},children:[Object(b.jsxs)("div",{className:"col-12",children:[Object(b.jsx)("label",{className:"visually-hidden",htmlFor:"newProject",children:"New project name:"}),Object(b.jsx)("input",{className:"form-control",type:"text",id:"newProject",value:N,onChange:function(e){w(e.target.value)}})]}),Object(b.jsx)("div",{className:"col-12",children:Object(b.jsx)("button",{className:"btn btn-success",type:"submit",children:"Submit"})}),Object(b.jsx)("div",{className:"col-12",children:Object(b.jsx)("button",{className:"btn btn-danger",type:"button",onClick:function(e){e.preventDefault(),w(""),x(!1)},children:"Cancel"})})]})]})]})}function _(e){var t=e.projects,n=Object(c.useState)([]),a=Object(i.a)(n,2),s=a[0],r=a[1];Object(c.useEffect)((function(){o.a.get("/api/reports/week").then((function(e){return r(e.data)}))}),[t]);var l=s.map((function(e){var n=e.project_id,c=e.sessions_total,a=e.blocks_total,s=t[n].title,r=1/3600,i=c*r||0,l=a*r||0;return Object(b.jsxs)("li",{children:[s,": ",i.toPrecision(1)," / ",l," hours"]},n)}));return Object(b.jsx)("div",{className:"reports",children:Object(b.jsx)("ul",{children:l})})}function H(e){var t=864e5*e.getDay(),n=e.valueOf()-t;return new Date(n)}function A(e){var t,n=new Date;(t=n).setHours(0),t.setMinutes(0),t.setSeconds(0),t.setMilliseconds(0);H(n);var a=Object(c.useState)(n),s=Object(i.a)(a,2),r=s[0],l=s[1],j=Object(c.useState)([]),u=Object(i.a)(j,2),b=u[0],d=u[1];Object(c.useEffect)((function(){o.a.get("/api/blocks/week").then((function(e){return d(e.data)}))}),[e]);return[b,function(){o.a.get("/api/blocks/week?date=".concat(r.toISOString())).then((function(e){return d(e.data)}))},r,function(e){var t=864e5*e,n=new Date(r.valueOf()+t);(function(e,t){var n=H(e),c=H(t);return n.getDate()!==c.getDate()})(r,n)&&o.a.get("/api/blocks/week?date=".concat(n.toISOString())).then((function(e){return d(e.data)})),l(n)}]}function U(){var e=function(){var e=Object(c.useState)(!0),t=Object(i.a)(e,2),n=t[0],a=t[1],s=Object(c.useState)(null),r=Object(i.a)(s,2),l=r[0],j=r[1];return Object(c.useEffect)((function(){o.a.post("/api/authenticate").then((function(e){j(e.data.username),a(!1)}))}),[]),[n,l,j,function(e){e.preventDefault(),o.a.post("/api/logout").then((function(e){return j(e.data.username)}))}]}(),t=Object(i.a)(e,4),n=t[0],a=t[1],s=t[2],r=t[3],l=A(a),h=Object(i.a)(l,4),O=h[0],p=h[1],x=h[2],f=h[3],v=function(e){var t=Object(c.useState)({}),n=Object(i.a)(t,2),a=n[0],s=n[1];return Object(c.useEffect)((function(){}),[e]),[a,function(e){var t=e.target.closest(".block");if(t){var n=Number(t.getAttribute("projectid"));a.id&&o.a.patch("/api/sessions",{session_id:a.id}).then((function(e){return console.log("stopped session:",e.data)})),console.log("checking ".concat(n," vs ").concat(a.project_id,", result: ").concat(n===a.project_id)),n===a.project_id?s({}):o.a.post("/api/sessions",{project_id:n}).then((function(e){return s(e.data)}))}}]}(a),g=Object(i.a)(v,2),k=g[0],S=g[1],M=function(){var e=Object(c.useState)(!1),t=Object(i.a)(e,2),n=t[0],a=t[1];return[function(){return a(!0)},function(){return a(!1)},n]}(),P=Object(i.a)(M,3),H=P[0],U=P[1],F=P[2],E=Object(c.useState)({}),B=Object(i.a)(E,2),L=B[0],T=B[1];return Object(c.useEffect)((function(){o.a.get("/api/projects").then((function(e){var t={};e.data.projects.forEach((function(e){return t[e.id]=e})),T(t)}))}),[a]),Object(b.jsxs)("div",{className:"App",onClick:S,children:[n&&Object(b.jsx)("p",{children:"Currently loading..."}),!n&&!a&&Object(b.jsx)(w,{setUsername:s}),!n&&a&&Object(b.jsx)(b.Fragment,{children:Object(b.jsxs)(j.a,{basename:"/timekeeper",children:[Object(b.jsx)(d,{username:a,handleLogout:r,currentSession:k}),Object(b.jsx)(m,{currentSession:k,projects:L}),Object(b.jsx)(N,{show:F,handleShow:H,handleClose:U,currentDay:x,projects:L,blocks:O,refreshBlocks:p}),Object(b.jsxs)(u.c,{children:[Object(b.jsx)(u.a,{exact:!0,path:["/","/schedule"],children:Object(b.jsx)(C,{blocks:O,day:x,tomorrow:function(){return f(1)},yesterday:function(){return f(-1)},showForm:H})}),Object(b.jsx)(u.a,{exact:!0,path:"/week",children:Object(b.jsx)(y,{})}),Object(b.jsx)(u.a,{exact:!0,path:"/projects",children:Object(b.jsx)(D,{projects:L,setProjects:T})}),Object(b.jsx)(u.a,{exact:!0,path:"/reports",children:Object(b.jsx)(_,{projects:L})})]})]})})]})}console.log("found a variable:","https://capensis-api.herokuapp.com"),o.a.defaults.baseURL="https://capensis-api.herokuapp.com",o.a.defaults.withCredentials=!0,r.a.render(Object(b.jsx)(a.a.StrictMode,{children:Object(b.jsx)(U,{})}),document.getElementById("root"))}},[[78,1,2]]]);
//# sourceMappingURL=main.caff4b54.chunk.js.map